<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase + Vercel</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Loading...</h1>
    
    <div style="margin-top: 20px;">
        <input type="text" id="msgInput" placeholder="Type a message..." />
        <button onclick="sendMessage()">Send to DB</button>
    </div>

    <script>
        const supabaseUrl = 'https://hqtyztqjnwpbfcbijuvb.supabase.co'
        const supabaseKey = 'sb_publishable_7vFBFbpeXCLYwo66KTb3uQ_RkQIKsMG'
        const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey)

        // 1. Fetch Data (READ)
        async function getMessages() {
            const { data, error } = await supabaseClient
                .from('messages')
                .select()
                .order('id', { ascending: false }) // Show newest first
                .limit(1)
            
            if (error) {
                console.error(error)
            } else {
                const message = data[0]?.text || "No messages found."
                document.querySelector('h1').innerText = message
            }
        }

        // 2. Send Data (WRITE)
        async function sendMessage() {
            const input = document.getElementById('msgInput')
            const text = input.value

            if (!text) return alert("Type something first!")

            const { error } = await supabaseClient
                .from('messages')
                .insert({ text: text }) // The column name is 'text'

            if (error) {
                alert("Error saving: " + error.message)
            } else {
                input.value = "" // Clear the box
                getMessages()    // Refresh the title instantly
            }
        }

        getMessages()
    </script>
</body>
</html>



